# Browser Fingerprinting with ThumbmarkJS

This document explains how browser fingerprinting is implemented in the Bounce v3 application using ThumbmarkJS.

## Overview

Browser fingerprinting is a technique used to identify and track visitors based on their browser and device characteristics. Unlike cookies, fingerprinting works even when cookies are disabled or cleared, providing a more persistent way to identify returning visitors.

In this application, we use [ThumbmarkJS](https://github.com/thumbmarkjs/thumbmarkjs), a free and open-source fingerprinting library that generates a unique identifier for each visitor based on various browser and device characteristics.

## Implementation

### Components

1. **Fingerprint Component** (`src/components/Fingerprint.tsx`)

   - Client-side component that generates a fingerprint using ThumbmarkJS
   - Collects additional browser and device information
   - Sends the data to the API for storage
   - Automatically tracks page visits

2. **Visitor Model** (`src/models/Visitor.ts`)

   - MongoDB schema for storing visitor information
   - Includes fields for device, browser, OS, screen, location, etc.
   - Tracks visit count and page visits

3. **API Endpoints**

   - `POST /api/v1/visitors` - Create or update visitor information
   - `GET /api/v1/visitors` - Retrieve all visitors (admin only)
   - `GET /api/v1/visitors/:id` - Retrieve a specific visitor (admin only)
   - `DELETE /api/v1/visitors/:id` - Delete a specific visitor (admin only)

4. **Admin Interface**
   - `/admin/visitors` - View all visitors with pagination
   - `/admin/visitors/:id` - View detailed information about a specific visitor

### Data Collected

The following data is collected and stored for each visitor:

- **Fingerprint ID**: A unique identifier generated by ThumbmarkJS
- **Visit Information**: First visit date, last visit date, visit count, visited pages
- **Referrer**: The referring URL
- **Device Information**: Device type (Mobile, Tablet, Desktop)
- **Browser Information**: Browser name, version, and engine
- **Operating System**: OS name and version
- **Screen Information**: Width, height, and color depth
- **Timezone**: Timezone name and offset
- **Language**: Browser language
- **Network Information**: Connection type, downlink speed, and effective type (if available)
- **Hardware Information**: CPU cores and memory (if available)
- **IP Address**: Client IP address (for geolocation)

## Usage

### Integration

The fingerprinting functionality is automatically integrated into the application. The `Fingerprint` component is included in the root layout (`src/app/layout.tsx`), so it runs on every page of the application.

```tsx
// src/app/layout.tsx
import Fingerprint from "../components/Fingerprint";

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        {/* ... */}
        {children}
        <Fingerprint />
      </body>
    </html>
  );
}
```

### Accessing Visitor Data

Administrators can access visitor data through the admin interface:

1. Navigate to `/admin/visitors` to view all visitors
2. Click on a visitor to view detailed information at `/admin/visitors/:id`

### API Usage

If you need to access visitor data programmatically, you can use the following API endpoints:

```typescript
// Get all visitors
const response = await fetch("/api/v1/visitors");
const data = await response.json();

// Get a specific visitor
const response = await fetch(`/api/v1/visitors/${visitorId}`);
const data = await response.json();
```

## Privacy Considerations

When using fingerprinting, it's important to consider privacy implications:

1. **Transparency**: Inform users that you're collecting this data in your privacy policy
2. **Data Minimization**: Only collect the data you need
3. **Security**: Ensure the data is stored securely
4. **Compliance**: Ensure compliance with privacy regulations like GDPR and CCPA

## Testing

Tests are included for all components of the fingerprinting system:

- `src/models/__tests__/Visitor.test.ts` - Tests for the Visitor model
- `src/app/api/v1/visitors/__tests__/route.test.ts` - Tests for the visitors API
- `src/app/api/v1/visitors/[id]/__tests__/route.test.ts` - Tests for the single visitor API

Run the tests with:

```bash
npm test
```

## Troubleshooting

If you encounter issues with the fingerprinting functionality:

1. Check the browser console for errors
2. Verify that ThumbmarkJS is properly installed
3. Check that the API endpoints are working correctly
4. Verify that the MongoDB connection is working

## References

- [ThumbmarkJS Documentation](https://github.com/thumbmarkjs/thumbmarkjs)
- [MongoDB Documentation](https://docs.mongodb.com/)
- [Next.js API Routes Documentation](https://nextjs.org/docs/api-routes/introduction)
